<section class="map" [attr.aria-label]="'map.ariaLabel' | translate">
  <header class="map__header">
    <p class="map__eyebrow">{{ 'map.hero.eyebrow' | translate }}</p>
    <h2 class="map__title">{{ 'map.hero.title' | translate }}</h2>
    <p class="map__subtitle">
      {{ 'map.hero.subtitle' | translate: { filtered: filteredCount, total: totalCount } }}
    </p>
  </header>

  <div class="map__body">
    <div
      #mapContainer
      class="map__canvas"
      role="presentation"
      [attr.aria-hidden]="isLoading() || isDataLoading || hasDataError ? 'true' : 'false'"
    ></div>

    <div class="map__overlay" *ngIf="isLoading() || isDataLoading">
      <p class="map__overlay-text">{{ 'map.overlay.loading' | translate }}</p>
    </div>

    <div class="map__overlay map__overlay--error" *ngIf="hasDataError && !isDataLoading">
      <p class="map__overlay-text">{{ 'map.overlay.error' | translate }}</p>
    </div>
  </div>

  <section class="map__footer" *ngIf="legend().length > 0">
    <p class="map__hint">{{ 'map.legend.hint' | translate }}</p>

    <div class="map__legend-controls">
      <button
        type="button"
        class="map__legend-reset"
        (click)="onLegendReset()"
        [disabled]="!activeSector()"
      >
        {{ 'map.legend.reset' | translate }}
      </button>
    </div>

    <ul class="map__legend" [attr.aria-label]="'map.legend.ariaLabel' | translate">
      <li
        class="map__legend-item"
        *ngFor="let entry of legend()"
        [class.map__legend-item--active]="isLegendEntryActive(entry.sector)"
        [class.map__legend-item--dimmed]="isLegendEntryDimmed(entry.sector)"
      >
        <button
          type="button"
          class="map__legend-button"
          (click)="onLegendToggle(entry.sector)"
          [attr.aria-pressed]="isLegendEntryActive(entry.sector)"
        >
          <span class="map__legend-color" [style.--legend-color]="entry.color"></span>
          <span class="map__legend-label">{{ entry.sector }}</span>
          <span class="map__legend-count">{{ entry.count }}</span>
        </button>
      </li>
    </ul>
  </section>

  <p class="map__hint map__hint--empty" *ngIf="legend().length === 0 && !isDataLoading && !hasDataError">
    {{ 'map.empty' | translate }}
  </p>
</section>
